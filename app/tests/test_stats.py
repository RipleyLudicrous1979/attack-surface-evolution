import numpy

from django.test import TestCase

from app import stats


class StatsTestCase(TestCase):
    def test_cohensd_pooled(self):
        # Arrange
        treatment = numpy.array([
            -0.1909, 0.0796, -0.1032, 0.0351, 0.1055, 0.1988, 0.0816, 0.0288,
            -0.0983, 0.047, -0.0455, -0.0642, 0.2252, 0.1346, 0.0405, -0.0241,
            0.0236, 0.0831, 0.1329, 0.0147, 0.033, -0.09, 0.1958, 0.0501,
            -0.003, 0.0585, 0.0032, 0.0657, 0.0529, 0.0729, 0.1191, 0.0146,
            0.1566, 0.0303, 0.0961, 0.0571, -0.0684, -0.0492, -0.1129, 0.0539,
            -0.158, -0.0778, 0.0786, 0.0311, 0.2111, -0.1399, -0.0752, -0.138,
            -0.0882, -0.0442, -0.0054, -0.0838, 0.0471, -0.013, 0.0343, 0.0422,
            -0.1364, 0.0809, -0.3157, -0.1781, 0.0373, -0.0818, 0.2089, 0.1024,
            0.0725, 0.043, -0.0599, 0.0851, -0.1427, -0.0485, 0.0225, -0.1206,
            -0.0574, -0.1701, 0.0449
        ])
        control = numpy.array([
            -0.071, 0.0125, -0.106, 0.0807, 0.0102, 0.0486, 0.0075, -0.0708,
            0.0222, -0.0098, 0.0005, 0.0613, 0.0912, 0.0029, -0.0192, -0.0535,
            -0.0087, 0.0022, 0.005, -0.0124, 0.0169, 0.0337, 0.0035, 0.0115,
            0.0134, 0.0313, 0.0656, -0.038, -0.0428, 0.0039, 0.0087, 0.0829,
            0.0076, -0.0282, 0.0028, 0.0113, 0.0326, -0.0602, -0.0297, -0.0661,
            -0.0456, 0.0063, 0.0634, -0.0398, 0.0386, 0.0498, -0.0181, 0.0074,
            0.0587, -0.0299, -0.0467, 0.0054, 0.0114, -0.0333, -0.0493,
            -0.0189, 0.0099, 0.002, -0.0227, -0.0542, -0.0073, 0.0193,
            0.0428, 0.0615, 0.036, -0.0062, 0.023, -0.0067, 0.0078, -0.0241,
            0.0351, -0.0302, -0.0867, -0.0396, -0.0026, 0.0244, -0.0398,
            0.0182, 0.0042, -0.0448, 0.0014, -0.0126, -0.005, -0.0268, -0.001,
            -0.024, 0.0089, 0.0101, 0.009, -0.0046, -0.0731, -0.0113, -0.0005,
            -0.0454, -0.022, 0.0592, -0.0552, 0.0719, -0.0298, 0.0165
        ])
        expected = 0.1066783

        # Act
        actual = stats.cohensd(treatment, control, pooled=True)

        # Assert
        self.assertAlmostEqual(expected, actual)

    def test_cohensd_unpooled(self):
        # Arrange
        treatment = numpy.array([
            0.1244, 0.0888, 0.0664, 0.0605, 0.0788, -0.1303, 0.0353, -0.1371,
            0.0563, -0.0733, 0.1198, -0.0158, 0.0955, 0.0005, 0.0591, 0.0045,
            -0.2206, -0.0659, 0.0655, -0.1134, -0.0809, -0.0099, 0.0767,
            0.0276, 0.1148, 0.1571, -0.1592, 0.0273, 0.0902, -0.2153, -0.1262,
            -0.0298, -0.0106, -0.0646, -0.2458, 0.1217, 0.1372, -0.1677,
            -0.0686, -0.0374, -0.0209, -0.0359, 0.1502, 0.1346, -0.0669,
            -0.167, -0.019, 0.1074, -0.1247, -0.0001, -0.0085, -0.1142, 0.1113,
            0.0056, -0.0619, 0.1105, 0.2767, 0.0833, 0.0602, 0.0381, 0.1104,
            -0.0609, -0.0496, 0.0258, -0.2075, 0.0049, -0.0808, -0.0076,
            0.0052, -0.1123, -0.1133, 0.0477, -0.1022, 0.0109, 0.096, -0.0563,
            -0.0126, -0.0179, -0.111, -0.1782, -0.2028, -0.0408, -0.0654,
            -0.0686, 0.0973, -0.0021, -0.1131, -0.0908, 0.2128, -0.1034,
            0.0492, -0.074, -0.0417, 0.0085, 0.0202, -0.1178, 0.07, -0.2075,
            -0.1189, 0.0821
        ])
        control = numpy.array([
            -0.0475, 0.2864, 0.0495, -0.1054, 0.0001, 0.0883, 0.0007, -0.0566,
            -0.2272, -0.0663, -0.1485, 0.1159, -0.058, 0.1546, 0.0719, -0.0711,
            -0.0439, 0.1223, -0.0039, -0.0272, 0.0258, 0.0416, -0.0924, 0.0679,
            -0.0189, -0.0386, -0.0383, -0.0842, 0.0995, -0.0502, -0.0403,
            0.2952, 0.0954, -0.0928, -0.0859, -0.1062, 0.1436, 0.1034, -0.0138,
            0.0916, 0.1387, 0.0292, -0.0065, 0.0382, -0.2298, -0.0077, -0.1525,
            0.1046, 0.0543, 0.045, -0.0372, -0.1987, 0.0889, -0.1253, -0.0006,
            0.0409, 0.0048, 0.0554, 0.0049, -0.149, 0.0344, 0.0496, 0.0125,
            0.1312, -0.1123, 0.0558, 0.0515, -0.1726, -0.0077, -0.0916, 0.2196,
            -0.2051, 0.119, 0.016, 0.1159, 0.113, 0.2302, 0.1226, 0.0455,
            0.039, 0.0659, -0.1001, -0.0338, -0.0953, 0.0232, -0.0587, -0.0677,
            -0.1488, -0.0932, -0.0115, -0.0122, -0.044, -0.0273, -0.1385,
            0.0547, -0.0219, 0.0841, 0.0309, 0.0208, -0.0353
        ])
        expected = -0.156152

        # Act
        actual = stats.cohensd(treatment, control, pooled=False)

        # Assert
        self.assertAlmostEqual(expected, actual)
